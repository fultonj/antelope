# Debugging EDPM node access to Control Plane End Points

My answer to questions like:

- Can my edpm node reach keystone?
- Is something missing from /etc/hosts?

We used to populate /etc/hosts on EDPM nodes using the following.
```
kind: OpenStackDataPlane
spec:
  roles:
    edpm-compute:
      nodeTemplate:
        ansibleVars: |
          edpm_hosts_entries_extra_hosts_entries:
          - 172.17.0.80 glance-internal.openstack.svc neutron-internal.openstack.svc cinder-internal.openstack.svc nova-internal.openstack.svc placement-internal.openstack.svc keystone-internal.openstack.svc
```
This is no longer necessary as after
https://github.com/openstack-k8s-operators/install_yamls/pull/249

Now, we install_yamls deploys a DNS server whose ingress IP can be
found this way:

```
[fultonj@hamfast ~]$ oc get svc -l service=dnsmasq -o json | jq -r '.items[0].status.loadBalancer.ingress[0].ip'
192.168.122.80
[fultonj@hamfast ~]$ 
```

The `EDPM_DNS_SERVER` variable gets set to the output of the above and
your edpm node should have that DNS server configued.

```
[root@edpm-compute-0 nova]# cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 192.168.122.80
[root@edpm-compute-0 nova]# 
```

Thus, it's normal to no longer have `/etc/hosts` populated.

In my experience the end points do not answer pings but I was
still able to boot an instance.

```
[root@edpm-compute-0 ~]# ping keystone-internal.openstack.svc
PING keystone-internal.openstack.svc (172.17.0.80) 56(84) bytes of data.
From 172.17.0.10 (172.17.0.10) icmp_seq=2 Redirect Host(New nexthop: cinder-internal.openstack.svc (172.17.0.80))
From 172.17.0.10 (172.17.0.10) icmp_seq=3 Redirect Host(New nexthop: cinder-internal.openstack.svc (172.17.0.80))
^C
--- keystone-internal.openstack.svc ping statistics ---
3 packets transmitted, 0 received, +2 errors, 100% packet loss, time 2059ms

[root@edpm-compute-0 ~]# 
```

After you confirm your edpm node is on the Internal API network.

```
[root@edpm-compute-0 ~]# ip a | grep -C 2 172.17
7: vlan20: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000
    link/ether b6:44:d5:e7:dc:76 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.100/24 brd 172.17.0.255 scope global vlan20
       valid_lft forever preferred_lft forever
    inet6 fe80::b444:d5ff:fee7:dc76/64 scope link 
[root@edpm-compute-0 ~]# 
```

you can confirm if the end points are working from it by using curl:

```
curl -i \
  -H "Content-Type: application/json" \
  -d '
{ "auth": {
    "identity": {
      "methods": ["password"],
      "password": {
        "user": {
          "name": "nova",
          "domain": { "id": "default" },
          "password": "12345678"
        }
      }
    }
  }
}' \
  "http://keystone-internal.openstack.svc:5000/v3/auth/tokens" ; echo
```
